<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asteroid Droid</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.15.0/dist/tf.min.js"></script>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas"></canvas>
        <div id="ui">
            <div id="hud">
                <div class="hud-header">
                    <div class="stat score-stat">
                        <span>Score: <span id="score">0</span></span>
                        <span style="margin-left: 15px; color: #66aaff;">High: <span id="highScore">0</span></span>
                    </div>
                    <div class="audio-controls">
                        <button id="musicToggle" class="audio-toggle" title="Toggle Music">ðŸŽµ</button>
                        <button id="soundToggle" class="audio-toggle" title="Toggle Sound Effects">ðŸ”Š</button>
                    </div>
                    <button id="autopilotToggle" class="autopilot-toggle" title="Toggle Autopilot (U)">
                        <span id="autopilotStatus">Autopilot: OFF</span>
                    </button>
                    <button id="hudToggle" class="hud-toggle" title="Toggle HUD">â–¼</button>
                </div>
                <div id="hudContent" class="hud-content collapsed">
                    <div id="trainingStats" class="training-stats hidden">
                        <h3>Training Progress</h3>
                        <div class="stat">
                            <span>Episode: <span id="trainingEpisode">0</span></span>
                            <span>Best Score: <span id="trainingBestScore">0</span></span>
                        </div>
                        <div class="stat">
                            <span>Avg Reward: <span id="trainingAvgReward">0</span></span>
                            <span>Total Reward: <span id="trainingTotalReward">0</span></span>
                        </div>
                    </div>
                    <div class="stat">
                        <span>Health: </span>
                        <div class="bar health-bar">
                            <div id="healthFill" class="fill"></div>
                        </div>
                        <span id="healthText">100/100</span>
                    </div>
                    <div class="stat">
                        <span>Shields: </span>
                        <div class="bar shield-bar">
                            <div id="shieldFill" class="fill"></div>
                        </div>
                        <span id="shieldText">50/50</span>
                    </div>
                    <div class="stat">
                        <span>Level: <span id="level">1</span></span>
                    </div>
                    <div class="stat">
                        <span>Allies: <span id="allies">0</span></span>
                    </div>
                    <div class="stat" id="cargoHealthStat" style="display: none;">
                        <span>Cargo Health: </span>
                        <div class="bar health-bar">
                            <div id="cargoHealthFill" class="fill"></div>
                        </div>
                        <span id="cargoHealthText">200/200</span>
                    </div>
                </div>
            </div>
            <div id="weapons">
                <div class="weapon-info">
                    <span>Primary: <span id="primaryAmmo">âˆž</span></span>
                    <div class="cooldown-bar">
                        <div id="primaryCooldown" class="cooldown-fill"></div>
                    </div>
                </div>
                <div class="weapon-info">
                    <span>Missile: <span id="missileAmmo">5</span></span>
                    <div class="cooldown-bar">
                        <div id="missileCooldown" class="cooldown-fill"></div>
                    </div>
                </div>
                <div class="weapon-info">
                    <span>Laser: <span id="laserAmmo">3</span></span>
                    <div class="cooldown-bar">
                        <div id="laserCooldown" class="cooldown-fill"></div>
                    </div>
                </div>
                <div class="weapon-info">
                    <span>Cluster: <span id="clusterAmmo">0</span></span>
                    <div class="cooldown-bar">
                        <div id="clusterCooldown" class="cooldown-fill"></div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Mobile Controls - Only visible on mobile devices -->
        <div id="mobileControls" class="mobile-controls">
            <div id="mobileWeapons" class="mobile-weapon-buttons">
                <button id="mobileMissileBtn" class="mobile-weapon-btn" data-weapon="missile">
                    <span class="weapon-label">Missile</span>
                    <span class="weapon-ammo" id="mobileMissileAmmo">5</span>
                </button>
                <button id="mobileLaserBtn" class="mobile-weapon-btn" data-weapon="laser">
                    <span class="weapon-label">Laser</span>
                    <span class="weapon-ammo" id="mobileLaserAmmo">3</span>
                </button>
            </div>
            <div id="mobileRotation" class="mobile-rotation-controls">
                <button id="mobileRotateLeftBtn" class="mobile-rotate-btn">â†¶</button>
                <button id="mobileRotateRightBtn" class="mobile-rotate-btn">â†·</button>
            </div>
            <button id="mobileTractorBeamBtn" class="mobile-tractor-btn">Tractor</button>
            <button id="mobileCommandBtn" class="mobile-command-btn">Command</button>
        </div>
        <div id="gameOver" class="hidden">
            <h2>Game Over</h2>
            <p>Final Score: <span id="finalScore">0</span></p>
            <p>High Score: <span id="finalHighScore">0</span></p>
            <button id="restartBtn">Restart</button>
        </div>
        <div id="upgradeMenu" class="hidden">
            <h3>Upgrade Available!</h3>
            <div id="upgradeOptions"></div>
            <button id="closeUpgrade">Close</button>
        </div>
        <div id="missionBriefing" class="hidden">
            <h2>Asteroid Droid: Mission Briefing</h2>
            <p class="briefing-tagline">Escort the cargo convoy across hostile space while your onboard AI learns from your instincts.</p>
            <div class="briefing-section">
                <h3>Objective</h3>
                <p>Keep the cargo ship alive, mine asteroids for upgrades, and eliminate enemy squadrons to earn credits. Complete enough deliveries to push deeper into the sector.</p>
            </div>
            <div class="briefing-section">
                <h3>Rules of Engagement</h3>
                <ul>
                    <li>Protect both your hull and the cargo vesselâ€”losing either ends the run.</li>
                    <li>Asteroids drop tokens; pick them up quickly to choose an upgrade.</li>
                    <li>Assign crew in the Command Module (P key / Command button) to boost systems.</li>
                    <li>Tractor asteroids or enemies, then destroy them for extra rewards.</li>
                </ul>
            </div>
            <div id="instructions" class="instructions">
                <h3>Controls</h3>
                <div class="instructions-content">
                    <div class="desktop-instructions">
                        <p><strong>Movement:</strong> WASD / Arrow Keys or mouse steering</p>
                        <p><strong>Primary Fire:</strong> Space or left-click (hold for continuous fire)</p>
                        <p><strong>Missile / Laser:</strong> Keys 1 and 2</p>
                        <p><strong>Tractor Beam:</strong> T key (toggle on mobile)</p>
                        <p><strong>Autopilot:</strong> U key to let the AI fly</p>
                        <p><strong>Command Module:</strong> P key to allocate crew & buy gear</p>
                    </div>
                    <div class="mobile-instructions">
                        <p><strong>Movement:</strong> Touch and drag to steer</p>
                        <p><strong>Primary Fire:</strong> Hold anywhere on screen</p>
                        <p><strong>Missile / Laser:</strong> Use weapon buttons</p>
                        <p><strong>Tractor Beam & Command:</strong> Use dedicated buttons</p>
                    </div>
                </div>
            </div>
            <button id="startMissionBtn" class="mode-btn">Get Started</button>
        </div>
        <div id="missionComplete" class="hidden">
            <h2>Mission Complete!</h2>
            <p>Cargo vessel safely delivered!</p>
            <p>Score: <span id="missionScore">0</span></p>
            <button id="missionRestartBtn">Play Again</button>
        </div>
        <div id="commandModule" class="hidden">
            <h2>Command Module</h2>
            <div class="command-tabs">
                <button id="crewTab" class="command-tab active">Crew</button>
                <button id="storeTab" class="command-tab">Store</button>
            </div>
            <div id="crewTabContent" class="command-tab-content">
                <div id="crewInfo">
                    <p>Total Crew: <span id="totalCrew">5</span></p>
                    <p>Currency: <span id="currencyCrew">0</span> credits</p>
                    <button id="recruitCrewBtn" class="recruit-btn">Recruit Crew (50 credits)</button>
                </div>
            <div id="stations">
                <div class="station" data-station="shields">
                    <h3>Shields</h3>
                    <div class="crew-assigned">
                        <span>Crew: <span id="shieldsCrew">0</span></span>
                        <div class="crew-slots" id="shieldsSlots"></div>
                    </div>
                    <p class="effect">+<span id="shieldsEffect">0</span>% regen rate</p>
                </div>
                <div class="station" data-station="engineering">
                    <h3>Engineering</h3>
                    <div class="crew-assigned">
                        <span>Crew: <span id="engineeringCrew">0</span></span>
                        <div class="crew-slots" id="engineeringSlots"></div>
                    </div>
                    <p class="effect">+<span id="engineeringEffect">0</span> HP/sec</p>
                </div>
                <div class="station" data-station="weapons">
                    <h3>Weapons</h3>
                    <div class="crew-assigned">
                        <span>Crew: <span id="weaponsCrew">0</span></span>
                        <div class="crew-slots" id="weaponsSlots"></div>
                    </div>
                    <p class="effect">-<span id="weaponsEffect">0</span>% cooldown, +<span id="weaponsDamageEffect">0</span>% damage</p>
                </div>
                <div class="station" data-station="navigation">
                    <h3>Navigation</h3>
                    <div class="crew-assigned">
                        <span>Crew: <span id="navigationCrew">0</span></span>
                        <div class="crew-slots" id="navigationSlots"></div>
                    </div>
                    <p class="effect">+<span id="navigationEffect">0</span>% speed</p>
                </div>
            </div>
            <div id="availableCrew">
                <h3>Available Crew</h3>
                <div class="crew-pool" id="crewPool"></div>
            </div>
            <div id="cargoShipCrew" style="display: none;">
                <h2 style="margin-top: 30px; margin-bottom: 15px;">Cargo Ship Crew</h2>
                <div id="cargoStations">
                    <div class="station" data-station="cargo-engineering">
                        <h3>Engineering</h3>
                        <div class="crew-assigned">
                            <span>Crew: <span id="cargoEngineeringCrew">0</span></span>
                            <div class="crew-slots" id="cargoEngineeringSlots"></div>
                        </div>
                        <p class="effect">+<span id="cargoEngineeringEffect">0</span> HP/sec</p>
                    </div>
                    <div class="station" data-station="cargo-navigation">
                        <h3>Navigation</h3>
                        <div class="crew-assigned">
                            <span>Crew: <span id="cargoNavigationCrew">0</span></span>
                            <div class="crew-slots" id="cargoNavigationSlots"></div>
                        </div>
                        <p class="effect">+<span id="cargoNavigationEffect">0</span>% speed</p>
                    </div>
                </div>
                <div id="cargoAvailableCrew">
                    <h3>Available Cargo Crew</h3>
                    <div class="crew-pool" id="cargoCrewPool"></div>
                </div>
                <div style="margin-top: 15px; padding: 10px; background: rgba(0, 50, 0, 0.3); border-radius: 8px;">
                    <p style="margin: 5px 0; font-size: 14px; color: #aaa;">Transfer crew from your ship to cargo ship by dragging them here</p>
                </div>
            </div>
            </div>
            <div id="storeTabContent" class="command-tab-content hidden">
                <div id="storeInfo">
                    <p>Currency: <span id="currencyStore">0</span> credits</p>
                </div>
                <div id="storeItems">
                    <div class="store-item">
                        <h3>Missile Ammo</h3>
                        <p>Add 2 missiles to your inventory</p>
                        <button id="buyMissileBtn" class="recruit-btn">Buy Missile Ammo (200 credits)</button>
                    </div>
                    <div class="store-item">
                        <h3>Laser Ammo</h3>
                        <p>Add 1 laser to your inventory</p>
                        <button id="buyLaserBtn" class="recruit-btn">Buy Laser Ammo (300 credits)</button>
                    </div>
                    <div class="store-item" id="cargoShipStoreItem" style="display: none;">
                        <h3>Cargo Ship</h3>
                        <p>Purchase an additional cargo vessel</p>
                        <p>Cargo Ships: <span id="cargoShipCount">0</span></p>
                        <button id="buyCargoShipBtn" class="recruit-btn">Buy Cargo Ship (<span id="cargoShipPrice">1000</span> credits)</button>
                    </div>
                    <div class="store-item" id="nebuclearStoreItem">
                        <h3>Nebuclear</h3>
                        <p>Makes nebulae disappear when you fire into them</p>
                        <button id="buyNebuclearBtn" class="recruit-btn">Buy Nebuclear (400 credits)</button>
                    </div>
                </div>
            </div>
            <button id="closeCommandModule">Close (ESC)</button>
        </div>
    </div>
    <script type="module" src="game.js"></script>
</body>
</html>

